use jni::sys::*;

use crate::core::command::*;
use crate::core::*;

foreign_enum!(
    enum CommandType {
        CreateView = CommandType::CreateView,
        SetChild = CommandType::SetChild,
    }
);

foreign_class!(class CommandList {
    self_type CommandList;
    private constructor = empty;
    fn CommandList::length(&self) -> usize;
    fn CommandList::get(&self, _: usize) -> Command;
});

foreign_class!(class Command {
    self_type Command;
    private constructor = empty;
    fn Command::commandType(&self) -> CommandType {
        this.command_type
    }
    fn Command::tag(&self) -> u32 {
        this.tag
    }
    fn Command::className(&self) -> String {
        this.class_name.clone()
    }
    fn Command::rootViewTag(&self) -> u32 {
        this.root_view_tag
    }
    fn Command::properties(&self) -> PropertyList {
        this.properties.clone()
    }
});

foreign_class!(class PropertyList {
    self_type PropertyList;
    private constructor = empty;
    fn PropertyList::length(&self) -> usize;
    fn PropertyList::get(&self, _: usize) -> String;
    foreign_code r#"
    public com.facebook.react.bridge.JavaOnlyMap toMap() {
        com.facebook.react.bridge.JavaOnlyMap map = new com.facebook.react.bridge.JavaOnlyMap();
        for (int i = 0;i < this.length();i += 2) {
            map.putDouble(this.get(i), Double.parseDouble(this.get(i + 1)));
        }
        return map;
    }
    "#;
});

foreign_class!(class Engine {
    self_type Engine;
    constructor Engine::new() -> Engine;
    fn Engine::launch(&self) -> ();
    fn Engine::run_app(&self, _: i32) -> CommandList;
});
